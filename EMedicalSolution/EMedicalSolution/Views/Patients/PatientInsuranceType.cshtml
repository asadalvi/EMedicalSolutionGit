@model IList<EMedicalSolution.Models.InsuranceType>



@using (Html.BeginForm("SavePatientInsuranceType", "Patients", FormMethod.Post, new { id = "popupForm" }))
{
    <div class="w3-border w3-row-padding w3-margin-bottom">
        @*if (Model != null && Model.ID > 0)
            {
                @Html.HiddenFor(a => a.ID)
            }*@
        <div class="w3-row w3-margin-top">
            <label class="w3-text-green">Choose Insurance Type</label>
        </div>
        <div class="w3-row">
            @foreach (var item in Model)
                {
                <div class="w3-half">
                    @Html.RadioButtonFor(a => item.ID, item.ID, new { @class = "w3-radio", @Name = "typeId" }) @item.Title <br />
                </div>
            }
        </div>

        <div class="w3-row w3-margin-top">

            <label class="w3-text-green">Upload Insurance Card</label><br>

            <div class="w3-half">
                <input type="file" name="filePath" id="insuranceCardfile" multiple="multiple" />
            </div>

            <div class="w3-half">
                Card Title: <input type="text" name="insuranceTitle" id="insuranceTitle" />
            </div>

        </div>

        <div class="w3-row w3-margin-top w3-center w3-margin-bottom">
            <div class="w3-third" style="float: none; margin: auto">
                <button class="w3-btn-block w3-green" id="addPatientInsurance" type="button">Save</button>
            </div>
        </div>
    </div>
}

<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
<script src="~/Scripts/jquery.dataTables.min.js"></script>
<script src="~/Scripts/jquery-ui-1.12.1.min.js"></script>
<script src="~/Scripts/date.format.js"></script>

<script>
    //save patient insurance type
    $('#addPatientInsurance').click(function () {
        $formData = new FormData();
        var pId = $("#historyList_patientID").val();
        var insuranceTitle = $("#insuranceTitle").val();
        var typeid = $("input[name='typeId']:checked").val();
        var $file = document.getElementById('insuranceCardfile');
        if ($file.files.length > 0) {
            for (var i = 0; i < $file.files.length; i++) {
                $formData.append('filePath', $file.files[i]);
            }
        }
        $.ajax({
            url: '/Patients/SavePatientInsuranceType?pId=' + pId + "&insuranceTitle=" + insuranceTitle + "&typeid=" + typeid,
            type: 'POST',
            data: $formData,
            dataType: 'json',
            contentType: false,
            enctype: 'multipart/form-data',
            processData: false,
            success: function ($data) {
                //$('#partialPatientInsuranceType').css('display', 'none');
                $('#partialPatientInsuranceType').html('');
                oTable.ajax.reload();

                // $(document).find("#patient_history_views").append('<tr role="row" class="even"><td class="sorting_1">' + $data.firstName + '</td><td>' + $data.lastName + '</td><td>' + $data.title + '</td><td>' + $data.createdDate + '</td><td><a class="popup  w3-btn w3-orange" href="/Patients/ViewHistory/"' + $data.pId + '>View</a><a></a></td></tr>');
                //$dialog.dialog('close');
                //$('#patientHistoryDataTable').empty();
                // $(".ui-dialog-titlebar-close").trigger("click");
                // $("#patientHistoryDataTable").dialog('open');
                //var oTable = $("#patientHistoryDataTable").DataTable({

                //    "ajax": {
                //        "url": '/Patients/getHistoryList/' + pId,
                //        "type": 'post',
                //        "datatype": "json"
                //    },
                //    "columns": [
                //        { "data": "FirstName", "autoWidth": true },
                //        { "data": "LastName", "autoWidth": true },
                //         { "data": "Title", "autoWidth": true },
                //        {
                //            "data": "Created", "autoWidth": true, "render": function (data) {
                //                var date = new Date(parseInt(data.substr(6)));
                //                var sdate = date.format("mmm d, yyyy");
                //                return sdate;
                //            }
                //        },

                //        {
                //            "data": "ID", "render": function (data) {
                //                return '<a class="popup  w3-btn w3-orange" href="/Patients/ViewHistory/' + data + '">View<a>';
                //            }
                //        }
                //    ]
                //});

                //$('.tablecontainer-history').on('click', 'a.popup', function (e) {
                //    e.preventDefault();
                //    OpenPopup($(this).attr('href'), oTable, "History");
                //});
            }
        });
    });
</script>